{%- import 'common.jinja2' as common with context -%}
{%- set NEW_OS = ["rhel9", "rocky9"] -%}
---
test-suites:
  ad_integration:
    test_ad_integration.py::test_ad_integration:
      dimensions:
        - regions: ["ap-southeast-2"]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: ["slurm"]
  configure:
    test_pcluster_configure.py::test_efa_and_placement_group:
      dimensions:
        - regions: [ "us-west-2" ]
          instances: {{ common.INSTANCES_EFA_SUPPORTED_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
  create:
    test_create.py::test_create_imds_secured:
      dimensions:
        - regions: [ "eu-south-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_create.py::test_cluster_creation_with_problematic_preinstall_script:
      dimensions:
        - regions: [ "ap-south-1" ]
          instances: {{ common.INSTANCES_DEFAULT_ARM }}
          schedulers: [ "slurm" ]
          oss: {{ NEW_OS }}
    test_create.py::test_cluster_creation_with_invalid_ebs:
      dimensions:
        - regions: [ "ap-south-1" ]
          instances: {{ common.INSTANCES_DEFAULT_ARM }}
          schedulers: [ "slurm" ]
          oss: {{ NEW_OS }}
    test_create.py::test_create_disable_sudo_access_for_default_user:
      dimensions:
        - regions: [ "ap-northeast-2" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          schedulers: [ "slurm" ]
          oss: {{ NEW_OS }}
  efa:
    test_efa.py::test_efa:
      dimensions:
        - regions: [ "sa-east-1" ]
          instances: [ "c5n.9xlarge" ]
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
        - regions: [ "use1-az6" ]   # do not move, unless capacity reservation is moved as well
          instances: [ "p4d.24xlarge" ]
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
        - regions: [ "us-east-1" ]
          instances: [ "c6gn.16xlarge" ]
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
  schedulers:
    test_slurm.py::test_error_handling:
      dimensions:
        - regions: [ "ca-central-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_slurm.py::test_slurm_protected_mode:
      dimensions:
        - regions: [ "ca-central-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_slurm.py::test_slurm_protected_mode_on_cluster_create:
      dimensions:
        - regions: [ "ap-east-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_slurm.py::test_fast_capacity_failover:
      dimensions:
        - regions: [ "ap-east-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_slurm.py::test_slurm_config_update:
      dimensions:
        - regions: [ "ap-east-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_slurm.py::test_slurm_memory_based_scheduling:
      dimensions:
        - regions: [ "ap-east-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_slurm.py::test_scontrol_reboot:
      dimensions:
        - regions: [ "us-east-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_slurm.py::test_scontrol_reboot_ec2_health_checks:
      dimensions:
        - regions: [ "us-east-2" ]
          instances: [ "t2.medium" ]
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_slurm.py::test_slurm_overrides:
      dimensions:
        - regions: [ "me-south-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_slurm_accounting.py::test_slurm_accounting:
      dimensions:
        - regions: [ "ap-south-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_slurm_accounting.py::test_slurm_accounting_disabled_to_enabled_update:
      dimensions:
        - regions: [ "us-west-2" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_slurm.py::test_slurm_reconfigure_race_condition:
      dimensions:
        - regions: [ "af-south-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_custom_munge_key.py::test_custom_munge_key:
      dimensions:
        - regions: [ "eu-west-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
  storage:
    test_fsx_lustre.py::test_multiple_fsx:
      dimensions:
        - regions: [ "eu-west-2" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
    test_shared_home.py::test_shared_home:
      dimensions:
        - regions: [ "us-west-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
  multiple_nics:
    test_multiple_nics.py::test_multiple_nics:
      dimensions:
        - regions: [ "use1-az6" ]
          instances: [ "c6in.32xlarge" ]
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
  health_checks:
    test_gpu_health_checks.py::test_cluster_with_gpu_health_checks:
      dimensions:
        - regions: [ "eu-west-1" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
  update:
    test_update.py::test_dynamic_file_systems_update:
      dimensions:
        - regions: [ "eu-west-2" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}
          schedulers: [ "slurm" ]
  createami:
    test_createami.py::test_build_image:
      dimensions:
        - regions: [ "eu-west-3" ]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: {{ NEW_OS }}